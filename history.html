<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Riwayat Tes MBTI</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="theme-toggle">
    <button id="theme-switch" class="toggle-btn">
      <span class="toggle-icon">ðŸŒ™</span>
      <span class="toggle-text">Dark Mode</span>
    </button>
  </div>
  <div class="container">
    <h1>Riwayat Tes MBTI</h1>
    <div id="history-list"></div>
    <button id="clear-history-btn">Hapus Riwayat</button>
    <br/><br/>
    <button id="back-btn">Kembali</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const themeSwitch = document.getElementById('theme-switch');
    const toggleIcon = document.querySelector('.toggle-icon');
    const toggleText = document.querySelector('.toggle-text');
    const historyList = document.getElementById('history-list');
    const clearBtn = document.getElementById('clear-history-btn');
    const backBtn = document.getElementById('back-btn');

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark');
      toggleIcon.textContent = 'â˜€ï¸';
      toggleText.textContent = 'Light Mode';
    }

    // Theme toggle functionality
    themeSwitch.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      toggleIcon.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
      toggleText.textContent = isDark ? 'Light Mode' : 'Dark Mode';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Load and display history
    function loadHistory() {
      const data = JSON.parse(localStorage.getItem('historyMBTI')) || [];
      if (data.length > 0) {
        let html = '';
        data.forEach((item, index) => {
          html += `<div class="history-item"><span>${item.timestamp} ${item.name} â€“ ${item.type}</span><button class="download-history-btn" data-index="${index}">Unduh</button></div>`;
        });
        historyList.innerHTML = html;
        // Add event listeners for download buttons
        document.querySelectorAll('.download-history-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = e.target.getAttribute('data-index');
            const item = data[index];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(16);
            doc.text('Riwayat Tes MBTI', 20, 30);
            doc.setFontSize(12);
            doc.text(`Nama: ${item.name}`, 20, 50);
            doc.text(`Tipe: ${item.type}`, 20, 60);
            doc.text(`Tanggal Tes: ${item.timestamp}`, 20, 70);
            doc.save(`riwayat_mbti_${item.name}_${item.timestamp.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`);
          });
        });
      } else {
        historyList.innerHTML = '<p>Belum ada riwayat.</p>';
      }
    }

    loadHistory();

    // Clear history
    clearBtn.addEventListener('click', () => {
      localStorage.removeItem('historyMBTI');
      loadHistory();
    });

    // Back to index
    backBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
